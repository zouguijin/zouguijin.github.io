<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Telnet Protocol | StarSea</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><!-- gallery that comes before the header--><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a><a href="/about" class="sidebar-nav-item">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/TCPIP/">TCPIP</a><a class="post-tag-link" href="/tags/TelnetProtocol/">TelnetProtocol</a></div><div class="post-time">2017-04-21</div></div></div><div class="container post-header"><h1>Telnet Protocol</h1></div><div class="container post-content"><h3 id="0-Telnet与远程登录"><a href="#0-Telnet与远程登录" class="headerlink" title="0  Telnet与远程登录"></a>0  Telnet与远程登录</h3><p>远程登录，即通过先登录一台主机，然后再通过网络远程登录到任何一台连接到网络的主机上（需要有登录账号和口令），而不需要为每一台主机连接一个硬件终端。</p>
<p>TCP/IP网络上，远程登录采用C/S模式，有两种远程登录的方法：</p>
<p>（1）Telnet，最古老的Internet应用，全称Telecommunication Network Protocol（电信网络协议）。Telnet受到TCP/IP的广泛支持，可以运行在不同操作系统的主机之间，Telnet客户端和服务器端之间通过<strong>选项协商机制</strong>，确定通信双方所能提供的通信功能。</p>
<p>（2）Rlogin，起源于伯克利Unix，现在也可以在其他操作系统上运行，比Telnet简单。</p>
<h3 id="1-Telnet与C-S模式"><a href="#1-Telnet与C-S模式" class="headerlink" title="1  Telnet与C/S模式"></a>1  Telnet与C/S模式</h3><ul>
<li>Telnet客户进程同时与<strong>终端用户</strong>和<strong>TCP/IP协议模块</strong>进行交互，所以在客户进程上键入的任何信息，将会通过TCP连接传输到服务器端，同时键入的信息和返回的信息都会回显在终端上。</li>
<li>Telnet只使用一条TCP连接，意味着控制信息和数据信息将会在一条TCP连接上传输，因此必须要有相应的方式区分控制命令和数据。</li>
<li>Telnet客户进程和服务器进程属于用户应用程序。</li>
</ul>
<h3 id="2-NVT-ASCII-与-Telnet-命令"><a href="#2-NVT-ASCII-与-Telnet-命令" class="headerlink" title="2  NVT ASCII 与 Telnet 命令"></a>2  NVT ASCII 与 Telnet 命令</h3><ul>
<li><p>NVT ASCII</p>
<p>Telnet协议定义了一种通用字符终端——网络虚拟终端NVT（Network Virtual Terminal）。</p>
<p>相应的，有NVT ASCII——<strong>7比特</strong>的ASCII字符集，网络之间的协议族都使用NVT ASCII。每7比特都将最高位置为0，然后以8比特的格式进行传送。</p>
<p>每一行结束都有两个字符——<strong>CR（回车） LF（换行）</strong>，也可以用<code>\r\n</code>表示。</p>
<p>NVT ASCII应用广泛，FTP、SMTP等协议都使用其来描述客户端发出的<strong>命令</strong>以及服务器对命令的<strong>应答</strong> 。</p>
</li>
</ul>
<ul>
<li><p>Telnet命令</p>
<p>Telnet通信的两个方向都采用<strong>带内信令</strong>方式，即在一个TCP连接上既传送数据又传送控制信令。</p>
<p><strong>IAC</strong>（Interpret as Command，字节码为0xff，即255），是Telnet命令的标识，<strong>其后</strong>会跟着相应的命令字节，所有<strong>IAC+命令字节</strong>构成了Telnet命令集。</p>
</li>
</ul>
<ul>
<li><p>选项协商</p>
<p>Telnet的连接双方在连接之初，首先会进行交互，以确定连接双方各自所需的通信功能，所用的方式就是<strong>选项协商机制</strong>。选项协商是<strong>对称</strong>的，即任何一方都可以主动地发送选项协商请求给对方。</p>
<p>选项协商需要3个字节：（1）IAC字节；（2）WILL/DO/WONT/DONT，四个字节中的一个；（3）ID字节，用于指定激活或者禁止选项。</p>
<p>虽然选项协商机制是对称的，但是客户端和服务器在协商的时候，<strong>各自的要求可以不一样</strong>，因为远程登录毕竟不是对称的应用，客户端有自己需要完成的任务，服务器则有属于自己的任务。</p>
</li>
<li><p>子选项协商</p>
<p>有些选项，不是简单地通过3个字节就能完全确定的，所以需要在3个字节的协商条件下，继续完成后续的协商，即子选项协商。</p>
<p>子选项协商建立在之前的3字节选项的基础上，<strong>以IAC SB起始，接ID字节，接后续子选项字节，最后以IAC SE终止</strong>，例如：</p>
<p>&lt; IAC,SB,24,1,IAC,SE &gt;</p>
</li>
<li><p>通信方式</p>
<p>Telnet客户端与服务器之间一共有四种通信方式：半双工、一次一个字符（默认方式）、一次一行（准行方式）以及行方式。</p>
<p>其中，一次一个字符的默认方式，客户端所键入的每个字符都会单独发送到服务器进程，然后服务器进程将会回显大多数的字符（除非服务器应用程序没有启用回显功能）。</p>
</li>
<li><p>同步方式与同步信号</p>
<p>以Data Mark（DM）命令作为同步信号，该同步信号将以TCP<strong>紧急数据</strong>的形式发送（即标志比特URG=1），也即同步信号将<strong>随着数据流传输</strong>，用于告诉同步信号的接收端回到正常的处理过程上，即重新开始正常地接收数据、处理数据。</p>
<p>为什么要使用TCP紧急数据的形式传输同步信号？因为，<strong>即使TCP数据流已经被TCP流量控制所终止，但是紧急数据（URG=1）还是可以进行传输</strong>，而同步信号（IAC+DM）就位于紧急数据的最后一个字节，这样一来就可以通过同步信号，告诉对方回到正常的数据传输和处理上。</p>
</li>
</ul>
<h3 id="3-总结"><a href="#3-总结" class="headerlink" title="3  总结"></a>3  总结</h3><p>Telnet作为Internet最早的应用之一，其基于TCP的通信模式和流程，为后来的很多Internet应用提供了最基础的参照。对Telnet的学习和理解，以及后续的实现（<em>又挖一个坑…</em>），对未来理解和实现网络编程应该会有具有很大的帮助。</p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>