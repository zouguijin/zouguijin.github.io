<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>leetcode123 Best Time to Buy and Sell Stock III | StarSea</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><!-- gallery that comes before the header--><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a><a href="/about" class="sidebar-nav-item">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/DynamicProgramming/">DynamicProgramming</a><a class="post-tag-link" href="/tags/array/">array</a><a class="post-tag-link" href="/tags/leetcode/">leetcode</a></div><div class="post-time">2017-09-05</div></div></div><div class="container post-header"><h1>leetcode123 Best Time to Buy and Sell Stock III</h1></div><div class="container post-content"><h2 id="leetcode-123-Best-Time-to-Buy-and-Sell-Stock-III"><a href="#leetcode-123-Best-Time-to-Buy-and-Sell-Stock-III" class="headerlink" title="leetcode#123 Best Time to Buy and Sell Stock III"></a>leetcode#123 Best Time to Buy and Sell Stock III</h2><blockquote>
<p>Say you have an array for which the <em>i</em>th element is the price of a given stock on day <em>i</em>.</p>
<p>Design an algorithm to find the maximum profit. You may complete at most <em>two</em> transactions.</p>
<p><strong>Note:</strong><br>You may not engage in multiple transactions at the same time (ie, you must sell the stock before you buy again).</p>
</blockquote>
<h4 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h4><p>给定一个数组，数组元素第i位表示的是：第i天的股票价格。要求设计一个算法，找到最大的利润，允许<strong>最多进行两次</strong>股票买进卖出操作。</p>
<p>与leetcode122一样，买进操作必须在前一次卖出操作之后。</p>
<h4 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h4><p>个人理解是，将数组划分成两个部分，两个部分分别利用Kadane’s Algorithm求解Max Subarray问题，然后再将结果加和到一起，即为本题答案。</p>
<h4 id="我的解法"><a href="#我的解法" class="headerlink" title="我的解法"></a>我的解法</h4><p>遵循了我的理解，但是该方法遇到了TLE限制，说明虽然答案正确，但是过于复杂而超时了……</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">class Solution &#123;</div><div class="line">    public int maxProfit(int[] prices) &#123;</div><div class="line">        int maxPro = 0;</div><div class="line">        int[] maxCur = new int[2];</div><div class="line">        for(int i = 1; i &lt; prices.length; i++) &#123;</div><div class="line">            maxCur[0] = maxPreProfit(prices,i);</div><div class="line">            maxCur[1] = maxLatProfit(prices,i);</div><div class="line">            if(maxPro &lt; maxCur[0] + maxCur[1]) </div><div class="line">                maxPro = maxCur[0] + maxCur[1];</div><div class="line">        &#125;</div><div class="line">        return maxPro;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    public int maxPreProfit(int[] prices, int end) &#123;</div><div class="line">        int maxPro = 0;</div><div class="line">        int maxCur = 0;</div><div class="line">        for(int i = 1; i &lt; end + 1; i++) &#123;</div><div class="line">            maxCur = Math.max(0, maxCur += prices[i] - prices[i-1]);</div><div class="line">            maxPro = Math.max(maxPro, maxCur);</div><div class="line">        &#125;</div><div class="line">        return maxPro;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    public int maxLatProfit(int[] prices, int begin) &#123;</div><div class="line">        int maxPro = 0;</div><div class="line">        int maxCur = 0;</div><div class="line">        for(int i = begin + 1; i &lt; prices.length; i++) &#123;</div><div class="line">            maxCur = Math.max(0, maxCur += prices[i] - prices[i-1]);</div><div class="line">            maxPro = Math.max(maxPro, maxCur);</div><div class="line">        &#125;</div><div class="line">        return maxPro;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="大神解法"><a href="#大神解法" class="headerlink" title="大神解法"></a>大神解法</h4><p>该解法考虑四个边界值的最大值：</p>
<ul>
<li>买入第一支股票<code>buy1</code> ，由于刚开始是没有钱的，所以需要将<code>buy1</code> <strong>初始化为负整数的最小值</strong>，然后将当前股票价格的负数赋值给<code>buy1</code> —— 相当于借钱买股票，借最少的钱买，后续才能赚更多；</li>
<li>卖出第一支股票，由于<code>buy1</code> 是负数，所以<code>buy1 + prices[i]</code> 表示按照当前股票价格将股票卖出所获取的利润；</li>
<li>买入第二支股票，第一次卖出股票之后的结余是<code>sell1</code> ，所以第二次买进股票希望剩下的钱最多，即<code>sell1 - prices[i]</code> 最大；</li>
<li>卖出第二支股票，同样，买入剩余的钱为<code>buy2</code> ，那么再次卖出股票所获取的利润为<code>buy2 + prices[i]</code> 。</li>
</ul>
<p>整个过程<strong>只有一个<code>for</code> 循环</strong>，四个边界值从头往后逐步推进，在推进的过程中，由<code>buy1</code> 确定整个数组的最小值，也即第一次买入股票的价格；在后续元素值大于前一个元素值的情况下，<code>sell1</code> 会进行累加，否则不变；如果<code>sell1</code> 增加，同样的<code>sell2</code> 也会增加；在遇到前一个元素大于后一个元素的时候，<code>buy2</code> 将会增加，因为相较于购买前一个价格较高的股票，可以通过购买后一个价格较低的股票，使得买入第二支股票后，剩余的钱<code>buy2</code> 增加。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public int maxProfit(int[] prices) &#123;</div><div class="line">		int sell1 = 0, sell2 = 0, buy1 = Integer.MIN_VALUE, buy2 = Integer.MIN_VALUE;</div><div class="line">		for (int i = 0; i &lt; prices.length; i++) &#123;</div><div class="line">			buy1 = Math.max(buy1, -prices[i]);</div><div class="line">			sell1 = Math.max(sell1, buy1 + prices[i]);</div><div class="line">			buy2 = Math.max(buy2, sell1 - prices[i]);</div><div class="line">			sell2 = Math.max(sell2, buy2 + prices[i]);</div><div class="line">		&#125;</div><div class="line">		return sell2;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>虽然本题也算作是动态规划的分类，<strong>每个小步骤都是计算买入卖出股票所获取利润的最大值</strong>，但是附上了应用数学的味道之后，有点让我难以分析——我总是在想，怎么将数组分成两部分，使得各自部分有最大的利润……</p>
<p>从本题可以看出，我的DP问题划分还是不够仔细、不够小，从而导致我后续的计算量过大，受到了TLE限制。</p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>